table routes_vehicles_last_position_v2
	lineageTag: b8136b63-96ce-428d-a7a6-617fc767a13f

	column route_id
		dataType: string
		sourceProviderType: nvarchar(max)
		lineageTag: cfa4e666-92a7-4e50-869c-7198f60d2907
		summarizeBy: none
		sourceColumn: route_id

		annotation SummarizationSetBy = Automatic

	column latitude
		dataType: double
		sourceProviderType: double
		lineageTag: dd9491ad-2f2d-4ec6-b425-bb2ecee16e8b
		dataCategory: Latitude
		summarizeBy: sum
		sourceColumn: latitude

		annotation SummarizationSetBy = Automatic

		annotation PBI_FormatHint = {"isGeneralNumber":true}

	column longitude
		dataType: double
		sourceProviderType: double
		lineageTag: 70719208-d593-41d2-8e55-c8ddb8deec88
		dataCategory: Longitude
		summarizeBy: sum
		sourceColumn: longitude

		annotation SummarizationSetBy = Automatic

		annotation PBI_FormatHint = {"isGeneralNumber":true}

	column sequence
		dataType: int64
		formatString: 0
		sourceProviderType: int
		lineageTag: 5ed1394a-88a2-43d6-8069-e766b2e36e0d
		summarizeBy: sum
		sourceColumn: sequence

		annotation SummarizationSetBy = Automatic

	column timestamp
		dataType: dateTime
		formatString: General Date
		sourceProviderType: datetimeoffset
		lineageTag: 10ff5d96-28de-4b07-a183-e10d5d3e5db6
		summarizeBy: none
		sourceColumn: timestamp

		annotation SummarizationSetBy = Automatic

	column progress_pct
		dataType: int64
		formatString: 0
		sourceProviderType: int
		lineageTag: 7b6048e6-5368-4d26-b091-6b2d5f655f2f
		summarizeBy: sum
		sourceColumn: progress_pct

		annotation SummarizationSetBy = Automatic

	column speed_kmh
		dataType: double
		sourceProviderType: double
		lineageTag: 6a84d0f9-304f-4342-b52b-712167f08a24
		summarizeBy: sum
		sourceColumn: speed_kmh

		annotation SummarizationSetBy = Automatic

		annotation PBI_FormatHint = {"isGeneralNumber":true}

	column status
		dataType: string
		sourceProviderType: nvarchar(max)
		lineageTag: cb7b3bce-1e6d-4088-8c3c-482c6985f702
		summarizeBy: none
		sourceColumn: status

		annotation SummarizationSetBy = Automatic

	column icon_map
		dataType: string
		sourceProviderType: nvarchar(max)
		lineageTag: 68478123-62af-4624-8912-fa2bb4dfe22f
		summarizeBy: none
		sourceColumn: icon_map

		annotation SummarizationSetBy = Automatic

	column kind
		dataType: string
		sourceProviderType: nvarchar(max)
		lineageTag: 7edb99f0-582d-4c81-90d1-36992fa54736
		summarizeBy: none
		sourceColumn: kind

		annotation SummarizationSetBy = Automatic

	column key
		dataType: string
		sourceProviderType: nvarchar(max)
		lineageTag: fa9f8e89-0bfc-4034-b5e1-5c40dd8a8ba9
		summarizeBy: none
		sourceColumn: key

		annotation SummarizationSetBy = Automatic

	partition routes_vehicles_last_position_v2 = m
		mode: directQuery
		source =
				let
				Source = AzureDataExplorer.Contents("https://trd-64402wcfv837yzr036.z9.kusto.fabric.microsoft.com", "751b8962-6c5d-4816-aea5-24d888ea4d55", "let route =
				    tb_route_segments_silver
				    | join kind=leftouter tb_routes_wkt_silver on route_id
				    | extend key = strcat(route_id, ""-"", tostring(sequence), ""-"", ""wkt"")
				    | project
				        route_id,
				        latitude = 0.0/0.0,
				        longitude = 0.0/0.0,
				        sequence,
				        timestamp,
				        progress_pct = int(0),
				        speed_kmh = real(0),
				        status = 'na',
				        icon_map = wkt,
				        ['kind'] = ""route"",
				        key;
				let live =
				    tb_vehicles_telemetry_silver
				    | summarize arg_max(timestamp, *) by vehicle_id
				    | extend key = strcat(route_id, ""-"", tostring(sequence), ""-"", ""img"")
				    | project
				        route_id,
				        latitude,
				        longitude,
				        sequence = int(0),
				        timestamp,
				        progress_pct,
				        speed_kmh,
				        status,
				        icon_map = ""https://img.icons8.com/?size=100&id=14739&format=png&color=000000"",
				        ['kind'] = ""vehicle"",
				        key;
				union route, live
				| order by route_id asc, kind asc, sequence asc", [])
				in
				Source

	annotation PBI_NavigationStepName = Navigation

	annotation PBI_ResultType = Table

