table routes_vehicles
	lineageTag: 083254a0-0ad3-4000-b138-a6ebcb3fa0d1

	column route_id
		dataType: string
		lineageTag: 19e47b39-d097-44c7-b4cf-76fbc44bb9c3
		summarizeBy: none
		sourceColumn: route_id

		changedProperty = IsHidden

		annotation SummarizationSetBy = Automatic

	column vehicle_id
		dataType: string
		lineageTag: 76e62ae2-ecc6-4493-9dee-a0a28436e17b
		summarizeBy: none
		sourceColumn: vehicle_id

		changedProperty = IsHidden

		annotation SummarizationSetBy = Automatic

	column latitude
		dataType: double
		lineageTag: 6683a164-4f9a-4866-a8ba-7df2b8c20233
		dataCategory: Latitude
		summarizeBy: none
		sourceColumn: latitude

		changedProperty = IsHidden

		changedProperty = DataType

		annotation SummarizationSetBy = User

		annotation PBI_FormatHint = {"isGeneralNumber":true}

	column longitude
		dataType: double
		lineageTag: cd7592fa-2263-4114-b2fe-38a72baffc78
		dataCategory: Longitude
		summarizeBy: none
		sourceColumn: longitude

		changedProperty = IsHidden

		annotation SummarizationSetBy = User

		annotation PBI_FormatHint = {"isGeneralNumber":true}

	column point_order
		dataType: int64
		formatString: 0
		lineageTag: bb10a6fc-e1fb-4fe3-9d29-92f7513e3219
		summarizeBy: sum
		sourceColumn: point_order

		changedProperty = IsHidden

		annotation SummarizationSetBy = Automatic

	column kind
		dataType: string
		lineageTag: 5b25025d-dbd9-49d3-a52a-07a9d3ad27a9
		summarizeBy: none
		sourceColumn: kind

		changedProperty = IsHidden

		annotation SummarizationSetBy = Automatic

	column shape_type
		dataType: string
		lineageTag: d8f2c8ca-73bf-464a-9165-ee13b92631b4
		summarizeBy: none
		sourceColumn: shape_type

		changedProperty = IsHidden

		annotation SummarizationSetBy = Automatic

	column timestamp
		dataType: string
		sourceProviderType: nvarchar(max)
		lineageTag: f0985606-8cb8-48da-9b6d-a755f1136b9f
		summarizeBy: none
		sourceColumn: timestamp

		annotation SummarizationSetBy = Automatic

	column progress_pct_int
		dataType: int64
		formatString: 0
		sourceProviderType: int
		lineageTag: 795156f4-4e1d-49bc-8b46-38c5efd0d0fc
		summarizeBy: sum
		sourceColumn: progress_pct_int

		annotation SummarizationSetBy = Automatic

	column progress_pct_real
		dataType: double
		sourceProviderType: double
		lineageTag: 1142a1c8-95ba-4e1d-bcc4-1a9d7762e05b
		summarizeBy: sum
		sourceColumn: progress_pct_real

		annotation SummarizationSetBy = Automatic

		annotation PBI_FormatHint = {"isGeneralNumber":true}

	column speed_kmh_int
		dataType: int64
		formatString: 0
		sourceProviderType: int
		lineageTag: 2f1f9f90-ef8e-400e-91bb-b0bd42e2f430
		summarizeBy: sum
		sourceColumn: speed_kmh_int

		annotation SummarizationSetBy = Automatic

	column speed_kmh_real
		dataType: double
		sourceProviderType: double
		lineageTag: 0695c3e0-c06f-4287-bb9d-a016f21bdcd6
		summarizeBy: sum
		sourceColumn: speed_kmh_real

		annotation SummarizationSetBy = Automatic

		annotation PBI_FormatHint = {"isGeneralNumber":true}

	column status
		dataType: string
		sourceProviderType: nvarchar(max)
		lineageTag: 8519e89f-7665-4889-b514-3b1601b8625a
		summarizeBy: none
		sourceColumn: status

		annotation SummarizationSetBy = Automatic

	partition routes_vehicles = m
		mode: directQuery
		source =
				let
				Source = AzureDataExplorer.Contents("https://trd-64402wcfv837yzr036.z9.kusto.fabric.microsoft.com", "751b8962-6c5d-4816-aea5-24d888ea4d55", "let route =
				    tb_route_segments
				        // make sure coords are numeric
				    | extend latitude  = todouble(latitude), longitude = todouble(longitude)
				    // choose the ordering field: prefer 'sequence', else fall back to 'point_index', else 0
				    | extend point_order = toint( column_ifexists(""sequence"", column_ifexists(""point_index"", 0)) )
				    | project
				        route_id,
				        vehicle_id = tostring(column_ifexists(""vehicle_id"","""")),
				        latitude,
				        longitude,
				        point_order,
				        timestamp,
				        progress_pct = int(0),
				        speed_kmh = int(0),
				        status = 'na',
				        ['kind'] = ""route"",
				        ['shape_type'] = ""‚îÅ"";
				let live =
				    tb_vehicles_telemetry
				    | summarize arg_max(timestamp, *) by vehicle_id
				    | extend latitude = todouble(latitude), longitude = todouble(longitude)
				    | project
				        route_id,
				        vehicle_id,
				        latitude,
				        longitude,
				        point_order = int(0),
				        timestamp,
				        progress_pct,
				        speed_kmh,
				        status,
				        ['kind'] = ""vehicle"",
				        ['shape_type'] = ""üöë"";
				union route, live
				| order by route_id asc, kind asc, point_order asc", [])
				in
				Source

	changedProperty = IsHidden

	annotation PBI_ResultType = Table

	annotation PBI_NavigationStepName = Navigation

